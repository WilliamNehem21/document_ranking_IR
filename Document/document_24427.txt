The signing of the Treaty of Fez in 1912 established a French protectorate over Morocco. The treaty had been prompted by the Agadir Crisis of 1911, during which French and Spanish troops had been sent to Morocco to put down a rebellion against Sultan Abdelhafid. The new French protectorate was led by a resident-general, Louis-Hubert Lyautey, and adopted the traditional Moroccan way of governing through the tribal system. Upon taking up his post Lyautey replaced Abdelhafid with his brother, Yusef. The tribes took offence at this, installing their own Sultan, Ahmed al-Hiba, in Marrakesh and taking eight Europeans captive. Lyautey acted quickly against the revolt, dispatching General Charles Mangin and 5,000 troops to retake the town. Mangin's men were highly successful, rescuing the captives and inflicting heavy casualties on vastly superior numbers of tribesmen for the loss of 2 men killed and 23 wounded. Al-Hiba escaped to the Atlas mountains with a small number of his followers and opposed French rule until his death in 1919.
A popular idea among the public in France was to possess an unbroken stretch of territory from Tunis to the Atlantic Ocean, including expansion into the "Taza corridor" in the Moroccan interior. Lyautey was in favour of this and advocated French occupation of the Middle Atlas mountains near Taza, through peaceful means where possible. This French expansion into the Middle Atlas was strongly opposed by the "powerful Berber trinity" of Mouha ou Hammou Zayani, leader of the Zaian Confederation; Moha ou Said, leader of the AÃ¯t Ouirra; and Ali Amhaouch, a religious leader of the Darqawa variant of Islam prevalent in the region.