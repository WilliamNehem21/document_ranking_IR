On 29 July 1565 when Mary married Henry Stuart, Lord Darnley, some of the Protestant nobles, including James Stewart, 1st Earl of Moray, rose up in rebellion. Knox revealed his own objection while preaching in the presence of the new King Consort on 19 August 1565. He made passing allusions on ungodly rulers which caused Darnley to walk out. Knox was summoned and prohibited from preaching while the court was in Edinburgh.
On 9 March 1566, Mary's secretary, David Rizzio, was murdered by conspirators loyal to Darnley. Mary escaped from Edinburgh to Dunbar and by 18 March returned with a formidable force. Knox fled to Kyle in Ayrshire, where he completed the major part of his "magnum opus", "History of the Reformation in Scotland". When he returned to Edinburgh, he found the Protestant nobles divided over what to do with Mary. Lord Darnley had been murdered and the Queen almost immediately married the chief suspect, the Earl of Bothwell. The indictment of murder thus upon her, she had been forced to abdicate and was imprisoned in Loch Leven Castle. Lord Moray had become the regent of King James VI. Other old friends of Knox's, Lord Argyll and William Kirkcaldy, stood by Mary. On 29 July 1567, Knox preached James VI's coronation sermon at the church in Stirling. During this period Knox thundered against her in his sermons, even to the point of calling for her death. However, Mary's life was spared, and she escaped on 2 May 1568.